<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Todo App</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
    <div class="container">
        <!-- Navbar -->
        <div class="navbar">
            <h1>Todo List</h1>
            <form th:action="@{/logout}" method="post" style="margin: 0;">
                <button type="submit" class="btn btn-secondary btn-sm">Logout</button>
            </form>
        </div>

        <div class="card">
            <!-- Search & Filter -->
            <form action="/" method="get" class="search-bar">
                <input type="text" name="keyword" placeholder="Search tasks..." th:value="${keyword}" />
                <select name="filter">
                    <option value="" th:selected="${filter == null || filter == ''}">All Status</option>
                    <option value="completed" th:selected="${filter == 'completed'}">Completed</option>
                    <option value="pending" th:selected="${filter == 'pending'}">Pending</option>
                </select>
                <button type="submit" class="btn btn-primary">Search</button>
                <a href="/" class="btn btn-secondary" style="width: auto;">Reset</a>
                <a href="/add" class="btn btn-primary" style="margin-left: auto;">+ New Task</a>
            </form>

            <!-- Todo Table -->
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Description</th>
                            <th>Due Date</th>
                            <th>Priority</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:if="${#lists.isEmpty(todos)}">
                            <td colspan="6" style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                                No tasks found. Create one to get started!
                            </td>
                        </tr>
                        <tr th:each="todo : ${todos}">
                            <td>
                                <span th:text="${todo.title}" th:classappend="${todo.completed} ? 'badge-completed'" style="font-weight: 500;"></span>
                            </td>
                            <td th:text="${todo.description}" style="color: var(--text-secondary);"></td>
                            <td>
                                <span th:text="${todo.dueDate}" style="font-family: monospace;"></span>
                            </td>
                            <td>
                                <span th:text="${todo.priority}" th:classappend="'badge badge-' + ${todo.priority}"></span>
                            </td>
                            <td>
                                <span th:if="${todo.completed}" class="badge" style="background-color: #D1FAE5; color: #065F46;">Done</span>
                                <span th:unless="${todo.completed}" class="badge" style="background-color: #F3F4F6; color: #374151;">Pending</span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <a th:href="@{/toggle/{id}(id=${todo.id})}" class="btn btn-sm btn-secondary" 
                                       th:text="${todo.completed} ? 'Undo' : 'Done'"></a>
                                    <a th:href="@{/edit/{id}(id=${todo.id})}" class="btn btn-sm btn-primary">Edit</a>
                                    <a th:href="@{/delete/{id}(id=${todo.id})}" class="btn btn-sm btn-secondary" style="color: var(--danger-color); border-color: var(--danger-color);" onclick="return confirm('Are you sure?')">Delete</a>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
</html>
